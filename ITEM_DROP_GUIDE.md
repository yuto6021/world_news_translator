# アイテムドロップガイド 🎁

## 概要

バトルで敵を倒すと、30%の確率でアイテムをドロップします。ドロップアイテムは**素材（材料）**と**装備品**の2種類に分かれます。

---

## ドロップアイテム一覧

### Stage 1: 初級エリア

#### スライム
- **ドロップアイテム**: `slime_jelly`（スライムゼリー）
- **用途**: 回復アイテムの素材、または錬金術の材料
- **属性**: 水属性
- **備考**: 初心者向けの基本素材

#### ゴブリン
- **ドロップアイテム**: `goblin_sword`（ゴブリンの剣）
- **用途**: 武器クラフトの素材、または低レベル装備として直接使用可能
- **効果**: 攻撃力+5%（装備時）
- **備考**: 初期段階の武器強化に便利

---

### Stage 2: 中級エリア

#### ウルフ
- **ドロップアイテム**: `wolf_fang`（狼の牙）
- **用途**: 武器クラフトの素材、クリティカル率アップ効果
- **レシピ例**: 剣/アクセサリ強化
- **属性**: 無属性

#### ゾンビ
- **ドロップアイテム**: `zombie_bone`（ゾンビの骨）
- **用途**: 防具クラフトの素材、闇属性アイテム製作
- **レシピ例**: 盾/アーマー強化
- **属性**: 闇属性

#### フェアリー
- **ドロップアイテム**: `fairy_dust`（妖精の粉）
- **用途**: 魔法系装備の素材、スキル威力強化
- **レシピ例**: 杖/アミュレット製作
- **属性**: 光属性

---

### Stage 3+: 上級エリア

#### エレメンタル
- **ドロップアイテム**: `elemental_crystal`（エレメンタルクリスタル）
- **用途**: 高級装備の素材、属性ダメージ強化
- **レシピ**: `item_staff_mage`など魔法武器に必須
- **属性**: 電気属性

#### ドラゴン
- **ドロップアイテム**: `dragon_scale`（ドラゴンスケール）
- **用途**: **最強装備**の素材
- **レシピ**: 
  - `item_sword_dragon`（攻撃+25%）
  - `item_shield_dragon`（防御+25%）
- **属性**: 火属性
- **希少度**: ★★★★

#### ゴーレム
- **ドロップアイテム**: `golem_core`（ゴーレムコア）
- **用途**: 防御系装備の素材、HP大幅アップ
- **レシピ**: 重装鎧/盾製作
- **属性**: 無属性

---

### ボスエリア

#### タイタン（ボス）
- **ドロップアイテム**: `titan_hammer`（タイタンハンマー）
- **用途**: レジェンダリー武器の素材
- **効果**: 攻撃力+30%、確定クリティカル率+10%
- **希少度**: ★★★★★

#### ダークロード（ボス）
- **ドロップアイテム**: `dark_sword`（ダークソード）
- **用途**: 闇属性最強武器として直接装備可能
- **効果**: 攻撃力+35%、闇属性ダメージ追加
- **希少度**: ★★★★★

#### ??? (シークレットボス)
- **ドロップアイテム**: `ultimate_crystal`（アルティメットクリスタル）
- **用途**: **覚醒装備**の製作素材
- **効果**: 全ステータス+50%の装備製作に必須
- **希少度**: ★★★★★★（最高レア）

---

## 素材の使い方

### 1. クラフトシステム
装備画面（Equipment Screen）でレシピを確認し、必要な素材を集めてクラフトします。

**例**: ドラゴンソードを作る場合
```
レシピ: item_sword_dragon
必要素材: dragon_scale x3
効果: 攻撃力+25%
```

### 2. 直接装備
一部のドロップアイテム（`goblin_sword`, `titan_hammer`, `dark_sword`など）は**そのまま装備可能**です。

装備方法:
1. 装備画面を開く
2. ペットを選択
3. ドロップした武器/防具を選択して装備

### 3. 素材交換（未実装予定）
将来的には素材同士を交換したり、ショップでコインに換金できる機能を追加予定。

---

## 効率的な素材集め

### ステージ選択の活用
- **初級素材が欲しい** → Stage 1に戻る
- **ドラゴンスケールが欲しい** → Stage 3以降を周回
- **ボス素材が欲しい** → 高レベル(Lv20+)でボス出現率10%

### ドロップ率アップ方法
- **コンボシステム**: 連続攻撃でドロップ率+5%（コンボ5以上）
- **装備効果**: 一部装備に「アイテムドロップ率+10%」効果あり
- **ラッキーステータス**: ペットの運ステータスが高いほどドロップ率UP

---

## 素材とレシピの対応表

| 素材名 | クラフト可能装備 | 必要個数 |
|--------|------------------|----------|
| `iron_ingot` | ブロンズソード、鉄の盾、チェインメイル | 2-4個 |
| `dragon_scale` | ドラゴンソード、ドラゴンシールド | 3個 |
| `ore_light_shard` | パラディンアーマー、セラフロッド | 3個 |
| `leather_strip` | レザーメイル、スウィフトブーツ | 2個 |
| `rune_stone` | クリティカルリング、ガードアミュレット | 2個 |
| `magic_core_medium` | メイジスタッフ | 2個 |

詳細レシピは`lib/services/equipment_service.dart`の`recipes`マップを参照。

---

## よくある質問

### Q: スライムゼリーをどう使うの？
A: 現在は素材として保管されます。将来的には回復アイテムとして使用可能になる予定です。

### Q: ゴブリンの剣は弱すぎる？
A: 序盤用の装備です。Stage 2以降でより強力な武器素材が手に入ります。

### Q: アイテムが入手できない
A: ドロップは30%の確率です。何度かバトルを繰り返してください。ボスは必ずドロップします。

### Q: 素材がどこに保存される？
A: `InventoryService`で管理され、装備画面から確認できます。SharedPreferencesで永続化されます。

---

## 開発者向けメモ

### アイテムドロップの実装位置
- `battle_screen.dart` 948-977行目: `_victory()`メソッド内
- ドロップ判定: `Random().nextInt(100) < 30`（30%）
- 保存: `InventoryService.addItem(_currentEnemy.itemDrop!)`

### 新しい素材を追加する方法
1. `equipment_service.dart`の`dropMaterials`マップに追加
2. 敵定義の`itemDrop`プロパティに設定
3. 対応する画像を`assets/materials/`に配置
4. レシピが必要な場合は`recipes`マップにも追加

---

**更新日**: 2025年
**バージョン**: 1.0
